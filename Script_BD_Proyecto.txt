CREATE DATABASE Rent_Go CHARACTER SET utf8mb4 COLLATE utf8mb4_spanish_ci;

USE Rent_Go;

CREATE TABLE TipoPropietario(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_TipoPropietario PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Propietario(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(100) NULL,
    apellido VARCHAR(100) NULL,
    razonSocial VARCHAR(250) NULL,
    nombreComercial VARCHAR(250) NULL,
    correoElectronico VARCHAR(100) NOT NULL,
    telefono INT NOT NULL,
    fechaNacimiento DATE NOT NULL,
    idTipoPropietario INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Propietario PRIMARY KEY (id),
    CONSTRAINT FK_TipoPropietario_Propietario FOREIGN KEY (idTipoPropietario) REFERENCES TipoPropietario(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Marca(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Marca PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Modelo(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    idMarca INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Modelo PRIMARY KEY (id),
    CONSTRAINT FK_Marca_Modelo FOREIGN KEY (idMarca) REFERENCES Marca(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE TipoVehiculo(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_TipoVehiculo PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Vehiculo(
    id INT NOT NULL AUTO_INCREMENT,
    year INT NOT NULL,
    color VARCHAR(100) NULL,
    placa VARCHAR(10) NOT NULL,
    imagen VARCHAR(250) NOT NULL,
    transmision VARCHAR(100) NOT NULL,
    pasajeros INT NOT NULL,
    motor VARCHAR(50) NOT NULL,
    gasolina VARCHAR(50) NOT NULL,
    idModelo INT NOT NULL,
    idTipoVehiculo INT NOT NULL,
    idPropietario INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Vehiculo PRIMARY KEY (id),
    CONSTRAINT U_Placa_Vehiculo UNIQUE (placa),
    CONSTRAINT FK_Modelo_Vehiculo FOREIGN KEY (idModelo) REFERENCES Modelo(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_TipoVehiculo_Vehiculo FOREIGN KEY (idTipoVehiculo) REFERENCES TipoVehiculo(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Propietario_Vehiculo FOREIGN KEY (idPropietario) REFERENCES Propietario(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Reserva(
    id INT NOT NULL AUTO_INCREMENT,
    cantidadDias INT NOT NULL,
    precioDia DECIMAL(6,2) NOT NULL,
    precioDiaExtra DECIMAL(6,2) NOT NULL,
    porcentajeComision DECIMAL(4,2) NOT NULL,
    descripcion TEXT NULL,
    lugarEntrega TEXT NOT NULL,
    fechaEntrega DATETIME NOT NULL,
    lugarDevolucion TEXT NOT NULL,
    disponible BOOLEAN NOT NULL DEFAULT TRUE,
    idVehiculo INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Reserva PRIMARY KEY (id),
    CONSTRAINT FK_Vehiculo_Reserva FOREIGN KEY (idVehiculo) REFERENCES Vehiculo(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Nacionalidad(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Nacionalidad PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Rol(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Rol PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Usuario(
    id INT NOT NULL AUTO_INCREMENT,
    correoElectronico VARCHAR(100) NOT NULL,
    contrasena VARCHAR(256) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    fechaNacimiento DATE NOT NULL,
    telefono INT NOT NULL,
    imagenPerfil VARCHAR(250) NULL,
    codigoVerificacion INT NOT NULL DEFAULT 0,
    verificado BOOLEAN NOT NULL DEFAULT FALSE,
    idNacionalidad INT NOT NULL,
    idRol INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Usuario PRIMARY KEY (id),
    CONSTRAINT U_CorreoElectronico_Usuario UNIQUE (correoElectronico),
    CONSTRAINT FK_Nacionalidad_Usuario FOREIGN KEY (idNacionalidad) REFERENCES Nacionalidad(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Rol_Usuario FOREIGN KEY (idRol) REFERENCES Rol(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Estado(
    id INT NOT NULL AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Estado PRIMARY KEY (id)
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;

CREATE TABLE Usuario_Reserva(
    id INT NOT NULL AUTO_INCREMENT,
    fechaReserva DATETIME NOT NULL,
    fechaFin DATETIME NOT NULL,
    favorito BOOLEAN NOT NULL DEFAULT FALSE,
    resena TEXT NULL,
    idEstado INT NOT NULL,
    idUsuario INT NOT NULL,
    idReserva INT NOT NULL,
    fechaFila TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT PK_Usuario_Reserva PRIMARY KEY (id),
    CONSTRAINT FK_Estado_Usuario_Reserva FOREIGN KEY (idEstado) REFERENCES Estado(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Usuario_Usuario_Reserva FOREIGN KEY (idUsuario) REFERENCES Usuario(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_Reserva_Usuario_Reserva FOREIGN KEY (idReserva) REFERENCES Reserva(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE = INNODB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_spanish_ci;